# Тест Storm Trident топологии
Ситуация:
<br>
На входе есть Kafka-топик `log-topic`, куда складываются некие логи. Формат сообщения в топике JSON-список, в котором >= 0 записей, для каждой из записей ожидаются поля timestamp, host, level и text.

    [
        {
            timestamp:11112222,
            host:"http://host1",
            level:"ERROR",
            text:"Error message"
        },
        {
            timestamp:112123432,
            host:"http://host2",
            level:"DEBUG",
            text:"Debug message"
        },
        .....
        {
            timestamp:1111333,
            host:"http://hostN",
            level:"INFO",
            text:"Info message"
        }
    ]

Топология скользящим окном длительностью 60 секунд высчитает среднюю частоту поступления (количество событий в секунду) и общее количество событий по окну для каждого из уровней:

<ul>
<li>TRACE</li>
<li>DEBUG</li>
<li>INFO</li>
<li>WARN</li>
<li>ERROR</li>
</ul>

Эти величины пишутся по каждому хосту и уровню в HBase.
Если частота поступления по уровню `ERROR` превышает порог 1 событие в секунду,
в Kafka-топик `alert-topic` необходимо записать событие об этом в формате JSON с полями `host` и `error_rate`

#Описание топологии
Топология представляет из себя streaming-pipeline состоящий из стадий:

1. Чтение сообщений из топика `log-topic`
2. Десериализация json в объектную модель `LogMessage`
3. Накапливание сообщений с помощью оконной функции длительностью и шагом 1 минута и сохранение входных кортежей в таблицу HBase `window_tuples_t1`
4. Расчёт частоты сообщений по каждому из уровней и сохранение результата в таблицу HBase `log-history`
5. Фильтрация сообщений по частоте и по уровню
6. Сериализация результата
7. Отправка результата в kafka-топик `alert-topic`

#Что нужно для запуска

Для запуска топологии в **локальном режиме** необходимо 2 docker-контейнера: Kafka и HBase

Образы которых можно скачать себе на локальный docker-демон с центрального docker-репозитория (по-умолчанию - docker.io) командами:

`docker pull zkhs/kafka:1`

`docker pull zkhs/hbase:1`
 
Оба контейнера содержат Centos 6.8, JDK 1.8 и Zookeeper 3.4.9

To be continue...